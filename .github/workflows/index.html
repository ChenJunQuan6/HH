<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯¹ä¸èµ·ï¼Œé™ˆæ…§å¨´</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft YaHei", sans-serif;
        }

        body {
            background: linear-gradient(135deg, #fef7fb 0%, #fcf1f7 100%);
            min-height: 100vh;
            position: relative;
            overflow: hidden; /* å½»åº•ç¦æ­¢æ»šåŠ¨ï¼Œå›ºå®šå¯è§†åŒºåŸŸ */
        }

        .apology-box {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 50px 30px;
            border-radius: 20px;
            box-shadow: 0 8px 25px rgba(230, 126, 157, 0.15);
            text-align: center;
            max-width: 400px;
            width: 100%;
            z-index: 100; /* ç¡®ä¿é¢æ¿åœ¨èŠ±ç“£ä¸Šå±‚ */
        }

        h1 {
            color: #e53e3e;
            margin-bottom: 40px;
            font-size: 24px;
        }

        .btn-group {
            display: flex;
            gap: 20px;
            justify-content: center;
            position: relative;
            min-height: 60px;
        }

        button {
            padding: 15px 35px;
            border: none;
            border-radius: 50px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
            height: 54px;
            /* å›ºå®šæŒ‰é’®ç›’æ¨¡å‹ï¼Œé¿å…å°ºå¯¸æ³¢åŠ¨ */
            display: inline-block;
        }

        #forgive {
            background: #48bb78;
            color: white;
            position: relative;
        }

        #forgive:hover {
            background: #38a169;
            transform: translateY(-2px);
        }

        #not-forgive {
            background: #e53e3e;
            color: white;
            position: absolute;
            top: 0;
            left: calc(50% + 40px);
            transition: all 0.1s ease;
            /* å¼ºåˆ¶æŒ‰é’®å°ºå¯¸ä¸éšå†…å®¹å˜åŒ– */
            white-space: nowrap;
        }

        #not-forgive:hover {
            background: #c53030;
        }

        /* èŠ±ç“£æ ·å¼ */
        .petal {
            position: absolute;
            background-color: #ffb6c1;
            border-radius: 50% 0 50% 50%;
            opacity: 0.8;
            z-index: 50; /* èŠ±ç“£åœ¨é¢æ¿ä¸‹å±‚ */
            pointer-events: none; /* èŠ±ç“£ä¸é˜»æŒ¡æŒ‰é’®ç‚¹å‡» */
            transform: rotate(45deg);
            animation: fall linear infinite;
        }

        /* èŠ±ç“£ä¸‹è½åŠ¨ç”»ï¼ˆå»¶é•¿æ—¶é•¿ï¼Œæ›´è‡ªç„¶ï¼‰ */
        @keyframes fall {
            0% {
                top: -10px;
                opacity: 0.8;
                transform: rotate(45deg) translateX(0);
            }
            100% {
                top: 100vh;
                opacity: 0;
                transform: rotate(225deg) translateX(50px);
            }
        }
    </style>
</head>
<body>
    <div class="apology-box">
        <h1>é™ˆæ…§å¨´ï¼Œå¯¹ä¸èµ· ğŸ˜”</h1>
        <div class="btn-group">
            <button id="forgive">åŸè°…ä½ </button>
            <button id="not-forgive">ä¸åŸè°…</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const forgiveBtn = document.getElementById('forgive');
            const notForgiveBtn = document.getElementById('not-forgive');
            let isForgiven = false;
            let petalInterval = null; // èŠ±ç“£å®šæ—¶å™¨ï¼Œç”¨äºæ§åˆ¶æ— é™ç”Ÿæˆ

            // ========== å¼ºåŒ–ç‰ˆæŒ‰é’®ä½ç½®è®¡ç®—ï¼ˆç»å¯¹ä¸å‡ºç•Œï¼‰ ==========
            const getBtnSafePos = () => {
                // å¼ºåˆ¶è·å–æŒ‰é’®çš„æœ€ç»ˆæ¸²æŸ“å°ºå¯¸ï¼ˆåŒ…å«padding/borderï¼‰
                const btnRect = notForgiveBtn.getBoundingClientRect();
                const btnWidth = btnRect.width;
                const btnHeight = btnRect.height;

                // å±å¹•å¯è§†åŒºåŸŸçš„çœŸå®è¾¹ç•Œï¼ˆæ’é™¤æ»šåŠ¨æ¡ï¼Œä»…å¯è§†åŒºåŸŸï¼‰
                const screenWidth = window.innerWidth;
                const screenHeight = window.innerHeight;

                // è®¡ç®—æŒ‰é’®å¯ç§»åŠ¨çš„æœ€å¤§èŒƒå›´ï¼š
                // å·¦è¾¹ç•Œï¼š0
                // å³è¾¹ç•Œï¼šå±å¹•å®½åº¦ - æŒ‰é’®å®½åº¦
                // ä¸Šè¾¹ç•Œï¼š0
                // ä¸‹è¾¹ç•Œï¼šå±å¹•é«˜åº¦ - æŒ‰é’®é«˜åº¦
                const maxLeft = Math.max(0, screenWidth - btnWidth);
                const maxTop = Math.max(0, screenHeight - btnHeight);

                // ç”Ÿæˆéšæœºä½ç½®ï¼Œä¸”å¼ºåˆ¶å…œåº•åœ¨å®‰å…¨èŒƒå›´å†…
                const randomLeft = Math.floor(Math.random() * (maxLeft + 1));
                const randomTop = Math.floor(Math.random() * (maxTop + 1));

                // æœ€ç»ˆå®‰å…¨ä½ç½®ï¼ˆåŒé‡å…œåº•ï¼Œç¡®ä¿ç»å¯¹ä¸å‡ºç•Œï¼‰
                return {
                    left: Math.min(Math.max(0, randomLeft), maxLeft),
                    top: Math.min(Math.max(0, randomTop), maxTop)
                };
            };

            // ç§»åŠ¨ä¸åŸè°…æŒ‰é’®ï¼ˆç»å¯¹ä¸å‡ºç•Œï¼‰
            const moveNotForgiveBtn = () => {
                if (isForgiven) return;
                
                // è·å–å®‰å…¨ä½ç½®
                const safePos = getBtnSafePos();
                
                // åº”ç”¨ä½ç½®ï¼ˆä½¿ç”¨fixedå®šä½ï¼ŒåŸºäºå¯è§†åŒºåŸŸï¼‰
                notForgiveBtn.style.position = 'fixed';
                notForgiveBtn.style.left = `${safePos.left}px`;
                notForgiveBtn.style.top = `${safePos.top}px`;
                
                // å¼ºåˆ¶æµè§ˆå™¨é‡ç»˜ï¼Œé¿å…ä½ç½®å»¶è¿Ÿ
                notForgiveBtn.offsetHeight;
            };

            // ä¸åŸè°…æŒ‰é’®äº‹ä»¶ç»‘å®šï¼ˆå…¨åœºæ™¯è§¦å‘ï¼‰
            notForgiveBtn.addEventListener('mouseover', moveNotForgiveBtn);
            notForgiveBtn.addEventListener('mousedown', moveNotForgiveBtn); // æŒ‰ä¸‹é¼ æ ‡å°±è§¦å‘ï¼Œæ›´éš¾ç‚¹å‡»
            notForgiveBtn.addEventListener('click', moveNotForgiveBtn);
            notForgiveBtn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                moveNotForgiveBtn();
            });

            // ========== èŠ±ç“£ç”Ÿæˆé€»è¾‘ï¼ˆä¿æŒä¸å˜ï¼‰ ==========
            const createSinglePetal = () => {
                const petal = document.createElement('div');
                petal.className = 'petal';
                const size = Math.random() * 15 + 10;
                petal.style.width = `${size}px`;
                petal.style.height = `${size}px`;
                petal.style.left = `${Math.random() * 100}vw`;
                const duration = Math.random() * 5 + 3;
                petal.style.animationDuration = `${duration}s`;
                const r = Math.floor(Math.random() * 30) + 220;
                const g = Math.floor(Math.random() * 30) + 170;
                const b = Math.floor(Math.random() * 30) + 180;
                petal.style.backgroundColor = `rgb(${r}, ${g}, ${b})`;
                document.body.appendChild(petal);
                setTimeout(() => {
                    petal.remove();
                }, duration * 1000);
            };

            const startPetalRain = () => {
                for (let i = 0; i < 20; i++) {
                    createSinglePetal();
                }
                petalInterval = setInterval(() => {
                    createSinglePetal();
                }, 100);
            };

            // åŸè°…æŒ‰é’®é€»è¾‘
            forgiveBtn.addEventListener('click', () => {
                if (isForgiven) return;
                isForgiven = true;
                startPetalRain();
                // æ¢å¤åˆå§‹ä½ç½®
                notForgiveBtn.style.position = 'absolute';
                notForgiveBtn.style.left = 'calc(50% + 40px)';
                notForgiveBtn.style.top = '0';
                setTimeout(() => {
                    alert('è°¢è°¢ä½ çš„åŸè°…ï¼æˆ‘ä»¥åå†ä¹Ÿä¸æ•¢äº†ï½â¤ï¸');
                }, 800);
            });

            // ç¦æ­¢å…³é—­é¡µé¢
            window.addEventListener('beforeunload', (e) => {
                if (!isForgiven) {
                    e.preventDefault();
                    e.returnValue = '';
                    return 'ä½ è¿˜æ²¡åŸè°…æˆ‘å‘¢ï¼Œåˆ«èµ°å•Šï¼';
                }
            });

            // çª—å£ç¼©æ”¾æ—¶é‡æ–°è®¡ç®—æŒ‰é’®ä½ç½®ï¼ˆé€‚é…çª—å£å˜åŒ–ï¼‰
            window.addEventListener('resize', () => {
                if (!isForgiven) moveNotForgiveBtn();
            });

            // æ¸…ç†å®šæ—¶å™¨
            window.addEventListener('unload', () => {
                if (petalInterval) clearInterval(petalInterval);
            });
        });
    </script>
</body>
</html>
